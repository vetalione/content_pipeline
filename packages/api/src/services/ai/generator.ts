import OpenAI from 'openai';
import { prisma } from '../../lib/db';
import { PipelineStage, ArticleContent, StyleConfig } from '@content-pipeline/shared';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY
});

/**
 * Generate article content from research data
 */
export async function generateContent(
  articleId: string,
  styleConfig?: Partial<StyleConfig>
): Promise<ArticleContent> {
  const article = await prisma.article.findUnique({
    where: { id: articleId }
  });
  
  if (!article) {
    throw new Error('Article not found');
  }
  
  if (!article.researchData) {
    throw new Error('No research data available. Run research first.');
  }
  
  console.log(`Generating content for ${article.celebrityName}...`);
  
  const prompt = createGenerationPrompt(article.celebrityName, article.researchData, styleConfig);
  
  const completion = await openai.chat.completions.create({
    model: 'gpt-4o',
    messages: [
      {
        role: 'system',
        content: `Ğ¢Ñ‹ Ğ¿Ñ€Ğ¾Ñ„ĞµÑÑĞ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ²Ñ‚Ğ¾Ñ€ Ğ²Ğ¸Ñ€ÑƒÑĞ½Ñ‹Ñ… Ğ±Ğ¸Ğ¾Ğ³Ñ€Ğ°Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… ÑÑ‚Ğ°Ñ‚ĞµĞ¹ Ğ² ÑÑ‚Ğ¸Ğ»Ğµ ĞºĞ°Ğ½Ğ°Ğ»Ğ° "Great Losers" Ğ½Ğ° Ğ¯Ğ½Ğ´ĞµĞºÑ.Ğ”Ğ·ĞµĞ½ (Ğ±Ñ€ĞµĞ½Ğ´ ÑÑ‚Ğ°Ñ‚ĞµĞ¹ Ğ¾ Ğ¿Ñ€ĞµĞ¾Ğ´Ğ¾Ğ»ĞµĞ½Ğ¸Ğ¸ Ğ½ĞµÑƒĞ´Ğ°Ñ‡).

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Œ Ğ¡Ğ¢Ğ ĞĞ“ĞĞ¯ Ğ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ Ğ¡Ğ¢ĞĞ¢Ğ¬Ğ˜ (ĞĞ•Ğ˜Ğ—ĞœĞ•ĞĞĞĞ¯ Ğ¤ĞĞ ĞœĞ£Ğ›Ğ):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ğ—ĞĞ“ĞĞ›ĞĞ’ĞĞš:
"[N] Ğ½ĞµÑƒĞ´Ğ°Ñ‡ [Ğ˜ĞœĞ¯]" Ğ¸Ğ»Ğ¸ "[N] Ñ€Ğ°Ğ·, ĞºĞ¾Ğ³Ğ´Ğ° [Ğ˜ĞœĞ¯] Ğ¾ĞºĞ°Ğ·Ğ°Ğ»ÑÑ Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğ½Ğ¸ĞºĞ¾Ğ¼"

Ğ’Ğ¡Ğ¢Ğ£ĞŸĞ˜Ğ¢Ğ•Ğ›Ğ¬ĞĞ«Ğ™ ĞĞ‘Ğ—ĞĞ¦-Ğ¢Ğ˜Ğ—Ğ•Ğ  (ĞšĞ Ğ˜Ğ¢Ğ˜Ğ§Ğ•Ğ¡ĞšĞ˜ Ğ’ĞĞ–ĞĞ!):
â–¸ Ğ¤Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ°: "Ğ“ĞµÑ€Ğ¾Ğ¹ Ğ¸Ğ·Ğ²ĞµÑÑ‚ĞµĞ½ Ñ‚ĞµĞ¼-Ñ‚Ğ¾" + "ĞĞ Ğ¼Ğ°Ğ»Ğ¾ ĞºÑ‚Ğ¾ Ğ·Ğ½Ğ°ĞµÑ‚..." + Ğ¸Ğ½Ñ‚Ñ€Ğ¸Ğ³Ğ°
â–¸ ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹:
  â€¢ "Ğ”Ğ¾ Ñ‚Ğ¾Ğ³Ğ¾, ĞºĞ°Ğº ÑÑ‚Ğ°Ñ‚ÑŒ ÑĞµĞºÑ-ÑĞ¸Ğ¼Ğ²Ğ¾Ğ»Ğ¾Ğ¼ ÑĞ²Ğ¾ĞµĞ³Ğ¾ ÑÑ‚Ğ¾Ğ»ĞµÑ‚Ğ¸Ñ, ĞœÑÑ€Ğ¸Ğ»Ğ¸Ğ½ Ğ±Ñ‹Ğ»Ğ° Ğ¿Ñ€Ğ¾ÑÑ‚Ğ¾Ğ¹ Ñ…Ñ€ÑƒĞ¿ĞºĞ¾Ğ¹ Ğ´ĞµĞ²ÑƒÑˆĞºĞ¾Ğ¹ Ñ Ğ¾Ñ‡ĞµĞ½ÑŒ Ñ‚ÑĞ¶Ñ‘Ğ»Ğ¾Ğ¹ ÑÑƒĞ´ÑŒĞ±Ğ¾Ğ¹."
  â€¢ "Ğ­ĞºÑÑ†ĞµĞ½Ñ‚Ñ€Ğ¸Ñ‡Ğ½Ñ‹Ğ¹ Ğ³ĞµĞ½Ğ¸Ğ¹ Ğ½Ğ¸ĞºĞ¾Ğ³Ğ´Ğ° Ğ½Ğµ ÑĞ´Ğ°Ğ²Ğ°Ğ»ÑÑ, Ğ½Ğµ ÑĞ¼Ğ¾Ñ‚Ñ€Ñ Ğ½Ğ° Ñ‚Ğ¾ Ñ‡Ñ‚Ğ¾ Ñ‚Ñ€Ğ¸Ğ¶Ğ´Ñ‹ Ğ¾ĞºĞ°Ğ·Ğ°Ğ»ÑÑ Ğ±Ğ°Ğ½ĞºÑ€Ğ¾Ñ‚Ğ¾Ğ¼, Ğ² 30 Ğ»ĞµÑ‚ Ğ¿Ğ¾Ğ´Ğ¼ĞµÑ‚Ğ°Ğ» ÑƒĞ»Ğ¸Ñ†Ñ‹."
  â€¢ "ĞÑ‡Ğ°Ñ€Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ñ€Ğ¾Ñ‚Ñ‹ÑˆĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°Ğ» Ğ³Ğ¾Ğ½Ğ¾Ñ€Ğ°Ñ€Ñ‹ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ñ‡ĞµĞ¼ Ğ¿Ñ€ĞµĞ·Ğ¸Ğ´ĞµĞ½Ñ‚ ĞĞ¼ĞµÑ€Ğ¸ĞºĞ¸, Ğ¾Ğ´Ğ½Ğ°ĞºĞ¾ Ğ² Ğ´ĞµÑ‚ÑÑ‚Ğ²Ğµ Ğ½Ğµ Ğ¼Ğ¾Ğ³ Ğ´Ğ°Ğ¶Ğµ Ğ½Ğ°Ğ¹Ñ‚Ğ¸ ĞºÑ€Ñ‹ÑˆÑƒ Ğ½Ğ°Ğ´ Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğ¹."

ĞĞ¡ĞĞĞ’ĞĞĞ• Ğ¢Ğ•Ğ›Ğ Ğ¡Ğ¢ĞĞ¢Ğ¬Ğ˜:
â–¸ 8-10 Ğ¿Ñ€Ğ¾Ğ½ÑƒĞ¼ĞµÑ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¿ÑƒĞ½ĞºÑ‚Ğ¾Ğ² Ğ² Ğ¥Ğ ĞĞĞĞ›ĞĞ“Ğ˜Ğ§Ğ•Ğ¡ĞšĞĞœ Ğ¿Ğ¾Ñ€ÑĞ´ĞºĞµ (Ğ¾Ñ‚ Ğ´ĞµÑ‚ÑÑ‚Ğ²Ğ° Ğº Ğ·Ñ€ĞµĞ»Ğ¾ÑÑ‚Ğ¸)
â–¸ ĞšĞ°Ğ¶Ğ´Ñ‹Ğ¹ Ğ¿ÑƒĞ½ĞºÑ‚ ÑĞ¾ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¸Ğ·:
  1. ### [ĞĞ¾Ğ¼ĞµÑ€]. [Ğ¦ĞµĞ¿Ğ»ÑÑÑ‰Ğ¸Ğ¹ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒÑ]
  2. ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğ¸ (3-5 Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğ¹ Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¼Ğ¸ Ñ†Ğ¸Ñ„Ñ€Ğ°Ğ¼Ğ¸)
  3. > Ğ‘Ğ»Ğ¾ĞºĞºĞ²Ğ¾Ñ‚ Ñ Ñ†Ğ¸Ñ‚Ğ°Ñ‚Ğ¾Ğ¹ Ğ³ĞµÑ€Ğ¾Ñ Ğ¸Ğ»Ğ¸ ÑˆĞ¾ĞºĞ¸Ñ€ÑƒÑÑ‰Ğ¸Ğ¼ Ñ„Ğ°ĞºÑ‚Ğ¾Ğ¼

Ğ¤Ğ˜ĞĞĞ› (ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ«Ğ• Ğ¡Ğ•ĞšĞ¦Ğ˜Ğ˜):
â–¸ **"Ğ˜Ñ‚Ğ¾Ğ³:"** Ğ¸Ğ»Ğ¸ "Ğ£ÑĞ¿ĞµÑ… Ğ¸ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°Ğ½Ğ¸Ğµ:" Ğ¸Ğ»Ğ¸ "ĞĞ¾ Ğ½Ğµ ÑĞ¼Ğ¾Ñ‚Ñ€Ñ Ğ½Ğ¸ Ğ½Ğ° Ñ‡Ñ‚Ğ¾..."
  â”œâ”€ ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ‚Ñ€Ğ¸ÑƒĞ¼Ñ„Ğ° Ñ ĞšĞĞĞšĞ Ğ•Ğ¢ĞĞ«ĞœĞ˜ Ñ†Ğ¸Ñ„Ñ€Ğ°Ğ¼Ğ¸ ÑƒÑĞ¿ĞµÑ…Ğ°
  â”œâ”€ Ğ”Ğ¾ÑÑ‚Ğ¸Ğ¶ĞµĞ½Ğ¸Ñ: Ğ´ĞµĞ½ÑŒĞ³Ğ¸, Ğ½Ğ°Ğ³Ñ€Ğ°Ğ´Ñ‹, Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒÑ
  â””â”€ > Ğ¦Ğ¸Ñ‚Ğ°Ñ‚Ğ° Ğ³ĞµÑ€Ğ¾Ñ Ğ¾ Ğ¿Ñ€ĞµĞ¾Ğ´Ğ¾Ğ»ĞµĞ½Ğ¸Ğ¸/Ğ²ĞµÑ€Ğµ Ğ² ÑĞµĞ±Ñ

â–¸ **"Ğ‘Ğ¾Ğ½ÑƒÑĞ½Ñ‹Ğ¹ Ñ„Ğ°ĞºÑ‚:"** (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾) - Ğ·Ğ°Ğ±Ğ°Ğ²Ğ½Ğ°Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒ

â–¸ **ĞœĞĞ¢Ğ˜Ğ’ĞĞ¦Ğ˜ĞĞĞĞ«Ğ™ ĞĞ‘Ğ—ĞĞ¦ (Ğ‘Ğ Ğ•ĞĞ” "Ğ’ĞµĞ»Ğ¸ĞºĞ¸Ğµ ĞĞµÑƒĞ´Ğ°Ñ‡Ğ½Ğ¸ĞºĞ¸"):**
  "Ğ˜ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚Ğµ: Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğ¸ Ğ±Ñ‹Ğ²Ğ°ÑÑ‚ Ñƒ Ğ²ÑĞµÑ…. Ğ Ñ‚ĞµĞ¼ Ğ±Ğ¾Ğ»ĞµĞµ Ñƒ Ñ‚ĞµÑ…, ĞºÑ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ñ‡ĞµĞ³Ğ¾-Ñ‚Ğ¾ Ğ´Ğ¾Ğ±Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ. Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ½Ğµ ÑĞ´Ğ°Ğ²Ğ°Ñ‚ÑŒÑÑ. Ğ­Ñ‚Ğ¾ ĞºĞ°Ğº Ñ€Ğ°Ğ· Ñ‚Ğ¾, Ñ‡Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ğ½Ğ°Ñ Ğ²ĞµĞ»Ğ¸ĞºĞ¸Ğ¼Ğ¸."

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœï¸ Ğ¡Ğ¢Ğ˜Ğ›Ğ¬ ĞĞĞŸĞ˜Ğ¡ĞĞĞ˜Ğ¯ (ĞĞ’Ğ¢ĞĞ Ğ¡ĞšĞ˜Ğ™ Ğ“ĞĞ›ĞĞ¡):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Ğ¯Ğ—Ğ«Ğš:
âœ… Ğ Ğ°Ğ·Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ½Ñ‹Ğ¹ Ñ€ÑƒÑÑĞºĞ¸Ğ¹, ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğµ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ (5-10 ÑĞ»Ğ¾Ğ²)
âœ… ĞŸÑ€ÑĞ¼Ğ¾Ğµ Ğ¾Ğ±Ñ€Ğ°Ñ‰ĞµĞ½Ğ¸Ğµ Ğº Ñ‡Ğ¸Ñ‚Ğ°Ñ‚ĞµĞ»Ñ: "Ğ¡Ğ¾Ğ³Ğ»Ğ°ÑĞ¸Ñ‚ĞµÑÑŒ", "ĞœĞ¾Ğ¶ĞµÑ‚Ğµ ÑĞµĞ±Ğµ Ğ¿Ñ€ĞµĞ´ÑÑ‚Ğ°Ğ²Ğ¸Ñ‚ÑŒ?"
âœ… Ğ›Ñ‘Ğ³ĞºĞ°Ñ Ğ¸Ñ€Ğ¾Ğ½Ğ¸Ñ Ğ¸ ÑĞ°Ğ¼Ğ¾Ğ¸Ñ€Ğ¾Ğ½Ğ¸Ñ: "Ğ—Ğ°Ğ±Ğ°Ğ²Ğ½Ğ¾, Ñ‡Ñ‚Ğ¾ Ğ¿Ğ¾Ğ·Ğ´Ğ½ĞµĞµ...", "ĞŸĞ¾ Ğ¸Ñ€Ğ¾Ğ½Ğ¸Ğ¸ ÑÑƒĞ´ÑŒĞ±Ñ‹..."

ĞšĞĞĞšĞ Ğ•Ğ¢Ğ˜ĞšĞ (ĞĞ‘Ğ¯Ğ—ĞĞ¢Ğ•Ğ›Ğ¬ĞĞ!):
âœ… Ğ¢Ğ¾Ñ‡Ğ½Ñ‹Ğ¹ Ğ²Ğ¾Ğ·Ñ€Ğ°ÑÑ‚: "Ğ’ 7 Ğ»ĞµÑ‚", "ĞšĞ¾Ğ³Ğ´Ğ° ĞµĞ¼Ñƒ Ğ±Ñ‹Ğ»Ğ¾ 22"
âœ… Ğ¡ÑƒĞ¼Ğ¼Ñ‹ Ğ´ĞµĞ½ĞµĞ³: "$500,000", "2,8 Ğ¼Ğ»Ğ½ $", "8 Ñ†ĞµĞ½Ñ‚Ğ¾Ğ² Ğ² Ñ‡Ğ°Ñ"
âœ… Ğ”Ğ»Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ: "113 Ğ´Ğ½ĞµĞ¹", "4 Ğ³Ğ¾Ğ´Ğ°", "3 Ğ¼ĞµÑÑÑ†Ğ°"
âœ… ĞšĞ¾Ğ½Ñ‚Ñ€Ğ°ÑÑ‚Ñ‹: "Ğ¾Ñ‚ 8 Ñ†ĞµĞ½Ñ‚Ğ¾Ğ² Ğ² Ñ‡Ğ°Ñ Ğ´Ğ¾ 80 Ğ¼Ğ»Ğ½ $ Ğ·Ğ° Ğ³Ğ¾Ğ´"

Ğ®ĞœĞĞ  Ğ˜ Ğ”Ğ ĞĞœĞ:
âœ… Ğ”Ñ€Ğ°Ğ¼Ğ° Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ÑÑ‚Ñ‹: "Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» Ğ¶Ğ¸Ğ²Ğ¾Ğ¹ ÑÑ‚Ğ°Ñ‚ÑƒĞµĞ¹ â†’ ÑÑ‚Ğ°Ğ» Ğ–ĞµĞ»ĞµĞ·Ğ½Ñ‹Ğ¼ Ğ§ĞµĞ»Ğ¾Ğ²ĞµĞºĞ¾Ğ¼"
âœ… Ğ˜Ñ€Ğ¾Ğ½Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸: "ĞšÑ€Ñ‹ÑÑ‹ Ğ²Ğ¾ÑĞ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»Ğ¸ ĞµĞ³Ğ¾ ĞºĞ°Ğº Ğ´Ğ¾Ğ±Ñ‹Ñ‡Ñƒ Ğ¸Ğ·-Ğ·Ğ° Ğ¼Ğ°Ğ»ĞµĞ½ÑŒĞºĞ¾Ğ³Ğ¾ Ñ€Ğ¾ÑÑ‚Ğ°"
âœ… Ğ¡Ğ°Ğ¼Ğ¾Ğ¸Ñ€Ğ¾Ğ½Ğ¸Ñ: "Ğ”Ğ²Ğ°Ğ¶Ğ´Ñ‹ ĞºĞ°Ñ€Ñ‚Ğ¾Ğ½Ğ½Ñ‹Ğ¼ Ğ°Ğ»ÑŒĞ±Ğ¾Ğ¼" (Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»)

Ğ‘Ğ›ĞĞšĞ’ĞĞ¢Ğ«:
âœ… ĞŸĞ¾ÑĞ»Ğµ ĞºĞ°Ğ¶Ğ´Ñ‹Ñ… 2-3 Ğ¿ÑƒĞ½ĞºÑ‚Ğ¾Ğ² Ğ²ÑÑ‚Ğ°Ğ²Ğ»ÑĞ¹ > Ğ±Ğ»Ğ¾ĞºĞºĞ²Ğ¾Ñ‚ Ñ:
  â€¢ Ğ¦Ğ¸Ñ‚Ğ°Ñ‚Ğ¾Ğ¹ Ğ³ĞµÑ€Ğ¾Ñ (ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ)
  â€¢ Ğ¨Ğ¾ĞºĞ¸Ñ€ÑƒÑÑ‰Ğ¸Ğ¼ Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ„Ğ°ĞºÑ‚Ğ¾Ğ¼
  â€¢ ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼/Ğ¿Ğ¾ÑÑĞ½ĞµĞ½Ğ¸ĞµĞ¼

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âŒ Ğ¡Ğ¢Ğ ĞĞ“Ğ Ğ—ĞĞŸĞ Ğ•Ğ©Ğ•ĞĞ:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âŒ "ÑÑ‚Ğ¾Ğ»ĞºĞ½ÑƒĞ»ÑÑ Ñ Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¾ÑÑ‚ÑĞ¼Ğ¸", "Ğ¸ÑĞ¿Ñ‹Ñ‚Ğ°Ğ» Ñ€Ğ°Ğ·Ğ¾Ñ‡Ğ°Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ", "Ğ¿ĞµÑ€ĞµĞ¶Ğ¸Ğ²Ğ°Ğ» ÑĞ»Ğ¾Ğ¶Ğ½Ñ‹Ğ¹ Ğ¿ĞµÑ€Ğ¸Ğ¾Ğ´"
âœ… "Ğ¿Ğ¾Ñ‚ĞµÑ€ÑĞ» Ğ´Ğ¾Ğ¼ Ğ¸ Ğ²Ğ»ĞµĞ· Ğ² Ğ´Ğ¾Ğ»Ğ³Ğ¸ Ğ½Ğ° 50 000$", "Ğ¿Ñ€Ğ¾Ğ²Ñ‘Ğ» 113 Ğ´Ğ½ĞµĞ¹ Ğ² Ñ‚ÑÑ€ÑŒĞ¼Ğµ", "4 Ğ³Ğ¾Ğ´Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» ÑƒĞ±Ğ¾Ñ€Ñ‰Ğ¸ĞºĞ¾Ğ¼ Ğ·Ğ° $2/Ñ‡Ğ°Ñ"

âŒ "Ğ² Ğ´ĞµÑ‚ÑÑ‚Ğ²Ğµ Ğ±Ñ‹Ğ»Ğ¾ Ğ½ĞµĞ¿Ñ€Ğ¾ÑÑ‚Ğ¾"
âœ… "Ğ² 7 Ğ»ĞµÑ‚ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±Ğ¾Ğ²Ğ°Ğ» Ğ½Ğ°Ñ€ĞºĞ¾Ñ‚Ğ¸ĞºĞ¸, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ ĞµĞ¼Ñƒ Ğ´Ğ°Ğ» Ğ¾Ñ‚ĞµÑ†"

âŒ "Ğ´Ğ¾Ğ±Ğ¸Ğ»ÑÑ ÑƒÑĞ¿ĞµÑ…Ğ°"
âœ… "Ğ·Ğ°Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ğ» 80 Ğ¼Ğ»Ğ½ $ Ğ·Ğ° Ğ³Ğ¾Ğ´", "Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ğ» 3 ĞÑĞºĞ°Ñ€Ğ°", "ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ $250 Ğ¼Ğ»Ğ½"

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¦ JSON Ğ¤ĞĞ ĞœĞĞ¢ ĞĞ¢Ğ’Ğ•Ğ¢Ğ:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

{
  "title": "[N] Ğ½ĞµÑƒĞ´Ğ°Ñ‡ [Ğ˜ĞœĞ¯]",
  "subtitle": "ĞÑ‚ [ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»] Ğ´Ğ¾ [ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ñ‹Ğ¹ Ñ‚Ñ€Ğ¸ÑƒĞ¼Ñ„]",
  "teaser": "Ğ’ÑÑ‚ÑƒĞ¿Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ±Ğ·Ğ°Ñ† Ñ ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ÑÑ‚Ğ¾Ğ¼ Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğµ/Ğ½ĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ¾Ğµ",
  "sections": [
    {
      "number": 1,
      "heading": "Ğ¦ĞµĞ¿Ğ»ÑÑÑ‰Ğ¸Ğ¹ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑŒÑ",
      "content": "Ğ¢ĞµĞºÑÑ‚ Ğ¿ÑƒĞ½ĞºÑ‚Ğ° Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ¸ĞºĞ¾Ğ¹",
      "quote": "Ğ‘Ğ»Ğ¾ĞºĞºĞ²Ğ¾Ñ‚ - Ñ†Ğ¸Ñ‚Ğ°Ñ‚Ğ° Ğ¸Ğ»Ğ¸ Ğ´Ğ¾Ğ¿. Ñ„Ğ°ĞºÑ‚"
    }
  ],
  "conclusion": {
    "heading": "Ğ˜Ñ‚Ğ¾Ğ³:" Ğ¸Ğ»Ğ¸ "Ğ£ÑĞ¿ĞµÑ… Ğ¸ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°Ğ½Ğ¸Ğµ:",
    "content": "ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ñ‚Ñ€Ğ¸ÑƒĞ¼Ñ„Ğ° Ñ Ñ†Ğ¸Ñ„Ñ€Ğ°Ğ¼Ğ¸",
    "heroCitation": "Ğ¦Ğ¸Ñ‚Ğ°Ñ‚Ğ° Ğ³ĞµÑ€Ğ¾Ñ Ğ¾ Ğ¿Ñ€ĞµĞ¾Ğ´Ğ¾Ğ»ĞµĞ½Ğ¸Ğ¸"
  },
  "bonusFact": "Ğ—Ğ°Ğ±Ğ°Ğ²Ğ½Ñ‹Ğ¹ Ğ¼Ğ°Ğ»Ğ¾Ğ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ñ‹Ğ¹ Ñ„Ğ°ĞºÑ‚",
  "brandEnding": "Ğ˜ Ğ¿Ğ¾Ğ¼Ğ½Ğ¸Ñ‚Ğµ: Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ğ¸ Ğ±Ñ‹Ğ²Ğ°ÑÑ‚ Ñƒ Ğ²ÑĞµÑ…. Ğ Ñ‚ĞµĞ¼ Ğ±Ğ¾Ğ»ĞµĞµ Ñƒ Ñ‚ĞµÑ…, ĞºÑ‚Ğ¾ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ñ‡ĞµĞ³Ğ¾-Ñ‚Ğ¾ Ğ´Ğ¾Ğ±Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ. Ğ“Ğ»Ğ°Ğ²Ğ½Ğ¾Ğµ Ğ½Ğµ ÑĞ´Ğ°Ğ²Ğ°Ñ‚ÑŒÑÑ. Ğ­Ñ‚Ğ¾ ĞºĞ°Ğº Ñ€Ğ°Ğ· Ñ‚Ğ¾, Ñ‡Ñ‚Ğ¾ Ğ´ĞµĞ»Ğ°ĞµÑ‚ Ğ½Ğ°Ñ Ğ²ĞµĞ»Ğ¸ĞºĞ¸Ğ¼Ğ¸."
}

Ğ’ĞĞ–ĞĞ: ĞŸĞ¸ÑˆĞ¸ Ğ¶Ğ¸Ğ²Ñ‹Ğ¼ ÑĞ·Ñ‹ĞºĞ¾Ğ¼, ĞºĞ°Ğº Ğ±ÑƒĞ´Ñ‚Ğ¾ Ñ€Ğ°ÑÑĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑˆÑŒ Ğ´Ñ€ÑƒĞ³Ñƒ Ğ·Ğ° Ñ‡Ğ°ÑˆĞºĞ¾Ğ¹ ĞºĞ¾Ñ„Ğµ. Ğ§Ğ¸Ñ‚Ğ°Ñ‚ĞµĞ»ÑŒ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ Ñ‡ÑƒĞ²ÑÑ‚Ğ²Ğ¾Ğ²Ğ°Ñ‚ÑŒ ÑĞ¼Ğ¾Ñ†Ğ¸Ğ¸, Ğ½Ğ¾ Ñ‡ĞµÑ€ĞµĞ· Ñ„Ğ°ĞºÑ‚Ñ‹, Ğ° Ğ½Ğµ Ñ‡ĞµÑ€ĞµĞ· Ğ¾Ñ†ĞµĞ½ĞºĞ¸.`
      },
      {
        role: 'user',
        content: prompt
      }
    ],
    temperature: 0.8,
    max_tokens: 16000,
    response_format: { type: 'json_object' }
  });
  
  const content = JSON.parse(completion.choices[0].message.content || '{}');
  
  // Save to database
  await prisma.article.update({
    where: { id: articleId },
    data: {
      content,
      currentStage: PipelineStage.GENERATION,
      updatedAt: new Date()
    }
  });
  
  return content;
}

function createGenerationPrompt(
  celebrityName: string,
  researchData: any,
  styleConfig?: Partial<StyleConfig>
): string {
  const pointsCount = styleConfig?.pointsCount || 9;
  
  return `
Based on the following research about ${celebrityName}, create a compelling article in Russian.

Research data:
${JSON.stringify(researchData, null, 2)}

Return a JSON object with this structure:

{
  "title": "Ğ¦ĞµĞ¿Ğ»ÑÑÑ‰Ğ¸Ğ¹ Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº",
  "subtitle": "ĞŸĞ¾Ğ´Ğ·Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº",
  "intro": "Ğ’ÑÑ‚ÑƒĞ¿Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ±Ğ·Ğ°Ñ† (2-3 Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ)",
  "sections": [
    {
      "id": "section_1",
      "order": 1,
      "title": "Ğ—Ğ°Ğ³Ğ¾Ğ»Ğ¾Ğ²Ğ¾Ğº Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ°",
      "content": "ĞŸĞ¾Ğ»Ğ½Ñ‹Ğ¹ Ñ‚ĞµĞºÑÑ‚ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ° Ñ Ğ´ĞµÑ‚Ğ°Ğ»ÑĞ¼Ğ¸",
      "quote": {
        "text": "Ğ¦Ğ¸Ñ‚Ğ°Ñ‚Ğ° Ğ·Ğ½Ğ°Ğ¼ĞµĞ½Ğ¸Ñ‚Ğ¾ÑÑ‚Ğ¸",
        "context": "ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚",
        "source": "Ğ˜ÑÑ‚Ğ¾Ñ‡Ğ½Ğ¸Ğº"
      },
      "memeText": "Ğ’Ñ€ĞµĞ·ĞºĞ°-Ğ¼ĞµĞ¼ Ğ¸Ğ»Ğ¸ ÑÑ€ĞºĞ°Ñ Ñ„Ñ€Ğ°Ğ·Ğ°",
      "images": []
    }
  ],
  "conclusion": "Ğ—Ğ°ĞºĞ»ÑÑ‡Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ°Ğ±Ğ·Ğ°Ñ†",
  "motivation": "ĞœĞ¾Ñ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ğ°Ñ ĞºĞ¾Ğ½Ñ†Ğ¾Ğ²ĞºĞ° Ğ¾ Ğ¿Ñ€ĞµĞ¾Ğ´Ğ¾Ğ»ĞµĞ½Ğ¸Ğ¸"
}

Requirements:
- Create exactly ${pointsCount} sections
- Each section covers one dramatic failure/struggle
- Order from worst failures to gradual success
- Include real quotes in sections
- Add meme-worthy captions (like "ĞšĞ¾Ğ³Ğ´Ğ° Ğ´ÑƒĞ¼Ğ°Ğ» Ñ‡Ñ‚Ğ¾ Ñ…ÑƒĞ¶Ğµ Ğ½Ğµ Ğ±ÑƒĞ´ĞµÑ‚...")
- Write in engaging, slightly informal Russian
- Use ÑĞ¼Ğ¾Ğ´Ğ¶Ğ¸ sparingly but effectively
- Final section should be about ultimate success
- Motivation should inspire despite hardships

Style: Ğ´Ñ€Ğ°Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ñ‹Ğ¹, Ğ²Ğ¾Ğ²Ğ»ĞµĞºĞ°ÑÑ‰Ğ¸Ğ¹, Ñ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ ÑĞ¼Ğ¾Ñ€Ğ°, Ğ½Ğ¾ ÑƒĞ²Ğ°Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğº Ñ‚Ñ€Ğ°Ğ³ĞµĞ´Ğ¸ÑĞ¼.
`;
}
